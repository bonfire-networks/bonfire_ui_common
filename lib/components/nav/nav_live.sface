<div 
  x-data="{
    open_sidebar_drawer: false,
    open_drawer: false
  }"
  :class="show_smart_input_fullscreen ? '!grid-cols-1 !place-content-start' : ''"
  class={
      "max-w-screen-lg tablet:max-w-screen-xl tablet-lg:max-w-screen-xl mx-auto p-3 justify-center grid-cols-1 md:grid-cols-[290px_minmax(auto,_580px)] tablet-lg:grid-cols-[290px_1fr_290px] grid gap-3 bonfire_layout",
       "!gap-6": !Settings.get([:ui, :compact], false, assigns)
    }>
  <Bonfire.UI.Common.SidebarLive
    page={@page}
    reply_to_id={@reply_to_id}
    thread_id={@thread_id}
    showing_within={e(@showing_within, nil)} 
    create_activity_type={e(@create_activity_type, nil)}
    to_boundaries={@to_boundaries}
    to_circles={e(@to_circles, [])}
    smart_input_prompt={@smart_input_prompt}
    smart_input_text={@smart_input_text}
    sidebar_widgets={@sidebar_widgets}
    thread_mode={e(@thread_mode, nil)}
    hide_smart_input={e(@hide_smart_input, false)}
    show_less_menu_items={@show_less_menu_items}
  />
  <div 
    :class="show_smart_input_fullscreen ? '!hidden' : ''"
    class="gap-2 md:gap-0 relative  w-full col-span-1 grid grid-rows-[1fr_48px] md:grid-rows-1">
    <Bonfire.UI.Common.HeaderMobileGuestLive  :if={!current_user(@__context__)} />
    <div 
      class={"grid relative invisible_frame",
      "grid-rows-[60px_1fr]": !Settings.get([:ui, :compact], false, assigns),
      "grid-rows-[40px_1fr]": Settings.get([:ui, :compact], false, assigns)
      }>
      <Bonfire.UI.Common.PageHeaderLive
        page_title={e(@page_title, nil)}
        page_header_drawer={e(@page_header_drawer, false)}
        >
        <:right_action>
          <Surface.Components.Dynamic.Component
            :if={current_user(@__context__) && e(@page_header_aside, nil)}
            :for={{component, component_assigns} <- e(@page_header_aside, [])}
            module={component}
            {...component_assigns}
          />
        </:right_action>
      </Bonfire.UI.Common.PageHeaderLive>

      <div data-id="inner_content" class="overflow-y-auto rounded-b-none md:overflow-y-visible full-height bg-base-100">
        {@inner_content}
      </div>
      
    </div>
    <Bonfire.UI.Common.HeaderUserLive 
      :if={current_user(@__context__)}
      page={@page} 
    />
  </div>
  <div 
    :class="show_smart_input_fullscreen ? '!hidden' : ''"
    class={
      "items-start sticky z-[100] top-3 hidden grid-flow-row gap-3 overflow-x-hidden overflow-y-auto widget tablet-lg:grid auto-rows-min",
       "!gap-5": !Settings.get([:ui, :compact], false, assigns),
    }>
    <div 
      :if={module_enabled?(Bonfire.Search.Web.FormLive) && current_user(@__context__)}
      class="sticky top-0 z-20">
      <Surface.Components.Dynamic.Component
        module={Bonfire.Search.Web.FormLive}
        search_limit={5}
      />
    </div>
    <Surface.Components.Dynamic.Component
      :if={current_user(@__context__)}
      :for={{component, component_assigns} <- @sidebar_widgets[:users][:secondary] || [ 
        {Bonfire.UI.Social.WidgetTagsLive, []},
        {Bonfire.UI.Common.WidgetFeedbackLive, []}
      ]}
      module={component}
      {...component_assigns}
    />

    <Surface.Components.Dynamic.Component
      :if={!current_user(@__context__)}
      :for={{component, component_assigns} <- @sidebar_widgets[:guests][:secondary] || [
          {Bonfire.UI.Social.WidgetTagsLive, []}
      ]}
      module={component}
      {...component_assigns}
    />
  </div>

  <!-- <Bonfire.UI.Common.SmartInputContainerLive
    :if={e(@hide_smart_input, nil) != true}
    hide_smart_input={e(@hide_smart_input, nil)}
    current_user={current_user(@__context__)}
    showing_within={e(@showing_within, nil)}
    reply_to_id={e(@reply_to_id, "")}
    thread_id={@thread_id}
    create_activity_type={e(@create_activity_type, nil)}
    thread_mode={e(@thread_mode, nil)}
    to_boundaries={e(@to_boundaries, [])}
    to_circles={e(@to_circles, [])}
    smart_input_prompt={@smart_input_prompt}
    smart_input_text={@smart_input_text}
  /> -->
    <div 
      :if={current_user(@__context__) && e(@showing_within, nil) != :messages}
      x-show="!show_smart_input_fullscreen"
      class="fixed bottom-0 z-[90] right-3 bottom-12 md:hidden">
      <button 
        @click="show_smart_input_fullscreen = true"
        type="button" 
        class="items-center btn btn-circle btn-primary btn-lg place-content-center ">
        <Solid.PencilAltIcon class="w-6 h-6" />
      </button>
    </div>
</div>
