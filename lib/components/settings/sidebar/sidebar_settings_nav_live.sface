<!-- <li class="!mt-1  menu-title">
  <span class="!text-base !font-medium capitalize">
    {l("User")}
  </span>
</li> -->
<nav class="" role="navigation" aria-label={l("Settings navigation")}>
  <ul class="flex flex-col gap-1 menu menu-compact">
    <li>
      <LiveRedirect
        to={~p"/settings"}
        class={"rounded-md", "bg-base-content/10 ": @selected_tab == "dashboard"}
      >
        <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
          <Icon solid="Home" class={"w-4 h-4 font-normal ", "": @selected_tab == "dashboard"} />
        </span>
        {l("Dashboard")}
      </LiveRedirect>
    </li>
  </ul>

  <ul x-data="{open: true}" class="menu menu-compact">
    <li @click="open = ! open">
      <div class="flex items-center justify-between">
        <span class="font-light text-base-content/70">{l("General")}</span>
        <div :class="{'rotate-180' : open}" class="transition-all btn btn-xs btn-ghost btn-circle">
          <Icon solid="ChevronDown" class="w-4 h-4" />
        </div>
      </div>
    </li>

    <div x-cloak x-show="open" x-collapse>
      <li :if={ulid(@current_user)}>
        <LivePatch
          to={~p"/settings/profile"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "profile"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="User" class={"w-4 h-4 font-normal ", "": @selected_tab == "profile"} />
          </span>
          {l("Profile")}
        </LivePatch>
      </li>
      <li>
        <LivePatch
          to={~p"/settings/preferences"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "preferences"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Adjustments" class={"w-4 h-4 font-normal ", "": @selected_tab == "preferences"} />
          </span>
          {l("Preferences")}
        </LivePatch>
      </li>

      <li>
        <LivePatch
          to={~p"/settings/account"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "account"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Key" class={"w-4 h-4 font-normal ", "": @selected_tab == "account"} />
          </span>
          {l("Account Settings")}
        </LivePatch>
      </li>

      <!-- <li>
        <LivePatch
          to={~p"/boundaries/circles"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "account"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Key" class={"w-4 h-4 font-normal ", "": @selected_tab == "account"} />
          </span>
          {l("Circles")}
        </LivePatch>
      </li>

      <li>
        <LivePatch
          to={~p"/settings/roles"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "account"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Key" class={"w-4 h-4 font-normal ", "": @selected_tab == "account"} />
          </span>
          {l("Roles")}
        </LivePatch>
      </li> -->

      <li :if={module_enabled?(Bonfire.Data.SharedUser, @__context__) &&
        Settings.get(:experimental_features_enabled, false, @__context__)}>
        <LivePatch
          to={~p"/settings/shared_user"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "shared_user"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="UserGroup" class={"w-4 h-4 font-normal ", "": @selected_tab == "shared_user"} />
          </span>
          {l("Team Profiles")}
        </LivePatch>
      </li>
    </div>
  </ul>

  <!-- <div x-data="{open: true}">
    <li @click="open = ! open" class="mt-4">
      <div class="flex items-center justify-between">
        <span class="font-light text-base-content/70">{l("Members")}</span>
        <div :class="{'rotate-180' : open}" class="transition-all btn btn-xs btn-ghost btn-circle">
          <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
          <Icon solid="ChevronDown" class="w-4 h-4" />
        </div>
      </div>
    </li>
    <ul x-cloak x-show="open" x-collapse class="menu menu-compact">
      <li>
        <LivePatch to={~p"/settings/members"} class={"rounded-md", 'bg-base-content/10 ': @selected_tab == "members"}>
          <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
          <Icon solid="Users" class={"w-4 h-4 font-normal ", "": @selected_tab == "members"} />
          {l("Members")}
        </LivePatch>
      </li>

      <li>
        <LivePatch to={~p"/settings/roles"} class={"rounded-md", 'bg-base-content/10 ': @selected_tab == "roles"}>
          <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
          <Icon
            iconify="bx:ShapeCircle"
            class={"w-4 h-4 font-normal ", "": @selected_tab == "roles"}
          />
          {l("Roles")}
        </LivePatch>
      </li>

      <li>
        <LivePatch to={~p"/settings/invites"} class={"rounded-md", 'bg-base-content/10 ': @selected_tab == "invites"}>
          <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
          <Icon solid="Mail" class={"w-4 h-4 font-normal ", "": @selected_tab == "invites"} />
          {l("Invites")}
        </LivePatch>
      </li>
    </ul>
  </div> -->

  <ul x-data="{open: true}" class="menu menu-compact">
    <li @click="open = ! open" class="mt-4">
      <div class="flex items-center justify-between">
        <span class="font-light text-base-content/70">{l("Moderation")}</span>
        <div :class="{'rotate-180' : open}" class="transition-all btn btn-xs btn-ghost btn-circle">
          <Icon solid="ChevronDown" class="w-4 h-4" />
        </div>
      </div>
    </li>

    <div x-cloak x-show="open" x-collapse>
      <li>
        <LivePatch
          to={~p"/settings/flags"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "flags"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Flag" class={"w-4 h-4 font-normal ", "": @selected_tab == "flags"} />
          </span>
          {l("Flagged")}
        </LivePatch>
      </li>

      <!-- <li>
        <LivePatch
          to={~p"/settings/ghosted"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "ghosted"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="MinusCircle" class={"w-4 h-4 font-normal ", "": @selected_tab == "ghosted"} />
          </span>
          {l("Ghosted")}
        </LivePatch>
      </li>
      <li>
        <LivePatch
          to={~p"/settings/silenced"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "silenced"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Ban" class={"w-4 h-4 font-normal ", "": @selected_tab == "silenced"} />
          </span>
          {l("Silenced")}
        </LivePatch>
      </li> -->
    </div>
  </ul>

  <ul x-data="{open: true}" class="menu menu-compact">
    <li @click="open = ! open" class="mt-4">
      <div class="flex items-center justify-between">
        <span class="font-light text-base-content/70">{l("Extension Settings")}</span>
        <div :class="{'rotate-180' : open}" class="transition-all btn btn-xs btn-ghost btn-circle">
          <Icon solid="ChevronDown" class="w-4 h-4" />
        </div>
      </div>
    </li>

    <div x-cloak x-show="open" x-collapse>
      {#for {extension, _} <- Bonfire.Common.SettingsModule.app_modules()}
        {#if Bonfire.Common.SettingsModule.extension_has_components?(extension)}
          <li>
            <Bonfire.UI.Common.WidgetLive
              widget={Bonfire.Common.ExtensionModule.extension(extension)
              |> Map.merge(%{href: "/settings/#{extension}"})}
              page={@page}
              selected_tab={@selected_tab}
            />
          </li>
        {/if}
        {#case Bonfire.Common.SettingsModule.nav(extension)}
          {#match %{} = nav}
            <li :if={!nav[:exclude_from_nav]}>
              <Bonfire.UI.Common.WidgetLive
                widget={nav}
                page={@page}
                selected_tab={@selected_tab}
                data={e(nav, :props, [])}
              />
            </li>
          {#match nav when is_list(nav)}
            <li :for={subnav <- nav} :if={!subnav[:exclude_from_nav]}>
              <Bonfire.UI.Common.WidgetLive
                widget={subnav}
                page={@page}
                selected_tab={@selected_tab}
                data={e(subnav, :props, [])}
              />
            </li>
        {/case}
      {/for}
    </div>
  </ul>

  <ul x-data="{open: true}" class="menu menu-compact">
    <li @click="open = ! open" class="mt-4">
      <div class="flex items-center justify-between">
        <span class="font-light text-base-content/70">{l("Advanced")}</span>
        <div :class="{'rotate-180' : open}" class="transition-all btn btn-xs btn-ghost btn-circle">
          <Icon solid="ChevronDown" class="w-4 h-4" />
        </div>
      </div>
    </li>

    <div x-cloak x-show="open" x-collapse>
      <li>
        <LivePatch
          to={~p"/settings/extensions"}
          class={"rounded-md", "bg-base-content/10 ": @selected_tab == "extensions"}
        >
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Puzzle" class={"w-4 h-4 font-normal ", "": @selected_tab == "extensions"} />
          </span>
          {l("Manage Extensions")}
        </LivePatch>
      </li>

      <li :if={Bonfire.Boundaries.can?(@__context__, :configure, :instance)}>
        <LivePatch to={~p"/settings/instance"}>
          <span class="rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg">
            <Icon solid="Adjustments" class="w-5 h-5 mr-2 font-normal" />
          </span>
          {l("Instance Settings")} â†’
        </LivePatch>
      </li>
    </div>
  </ul>
</nav>

<!-- <li>
    <LivePatch
      :if={module_enabled?(Bonfire.Invite.Links, @__context__) and
        Bonfire.Boundaries.can?(@__context__, :invite, :instance)}
      to="/posts"
      class={
        "",
     rounded-md   'bg-base-content/10 ': @selected_tab == "posts"
      }
    >
      <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
      <Icon solid="ChatAlt" class={"w-4 h-4 font-normal ", "": @selected_tab == "posts"} />
      {l("Posts")}
    </LivePatch>
  </li> -->

<!-- <li>
  <LivePatch 
    to={~p"/settings/ghosted"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "ghosted"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="MinusCircle" class={"inline-block w-4 h-4 mr-2 stroke-current", "": @selected_tab == "ghosted"} />
    {l "Ghosted"}
  </LivePatch>
</li>
<li>
  <LivePatch 
    to={~p"/settings/silenced"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "silenced"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="VolumeOff" class={"inline-block w-4 h-4 mr-2 stroke-current", "": @selected_tab == "silenced"} />
    {l "Silenced"}
  </LivePatch>
</li> -->

<!-- <li class="!mt-1  menu-title">
  <span class="!text-base !font-medium capitalize">
    {l("Instance")}
  </span>
</li> -->

<!-- <Bonfire.Boundaries.Web.IfCan object={:instance} verbs={:describe} id={Pointers.ULID.generate()}> -->
<!-- <li :if={Bonfire.Boundaries.can?(@__context__, :describe, :instance)}>
  <LivePatch
    to="/settings/instance_info"
    class={
      "",
   rounded-md   'bg-base-content/10 ': @selected_tab == "instance_info"
    }
  >
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon
      solid="Fire"
      class={"w-4 h-4 font-normal ", "": @selected_tab == "instance_info"}
    />
    {l("Instance Info")}
  </LivePatch>
</li>
</Bonfire.Boundaries.Web.IfCan> -->
<!-- 
<li :if={Bonfire.Boundaries.can?(@__context__, :configure, :instance)}>
  <LivePatch
    to="/settings/instance"
    class={
      "",
   rounded-md   'bg-base-content/10 ': @selected_tab == "instance"
    }
  >
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon
      solid="Adjustments"
      class={"w-4 h-4 font-normal ", "": @selected_tab == "instance"}
    />
    {l("Instance Settings")}
  </LivePatch>
</li> -->

<!-- <li :if={Bonfire.Boundaries.can?(@__context__, :toggle, :instance)}>
  <LivePatch 
    to="/settings/extensions"
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "extensions"}>
  <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
  <Icon solid="Puzzle" class={"w-4 h-4 font-normal ", "": @selected_tab == "feed"} />
  {l "Extensions"}
  </LivePatch>
</li> -->

<!-- <li :if={Bonfire.Boundaries.can?(@__context__, :configure, :instance)}>
  <LivePatch
    to="/settings/terms"
    class={
      "",
   rounded-md   'bg-base-content/10 ': @selected_tab == "terms"
    }
  >
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon
      solid="Scale"
      class={"w-4 h-4 font-normal ", "": @selected_tab == "terms"}
    />
    {l("Terms / Policies")}
  </LivePatch>
</li>

<li>
  <LivePatch
    :if={module_enabled?(Bonfire.Invite.Links) &&
      (!Settings.get(:invite_only, nil, :instance) or
         Bonfire.Boundaries.can?(@__context__, :invite, :instance))}
    to="/settings/invites"
    class={
      "",
   rounded-md   'bg-base-content/10 ': @selected_tab == "invites"
    }
  >
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon
      solid="Mail"
      class={"w-4 h-4 font-normal ", "": @selected_tab == "invites"}
    />
    {l("Invites")}
  </LivePatch>
</li> -->

<!-- <li
  :if={Bonfire.Boundaries.can?(@__context__, :assign, :instance)}
  >
  <LivePatch 
    to={~p"/boundaries/instance_circles"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "instance_circles"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon iconify="bx:ShapeCircle" class="inline-block w-5 h-5 mr-2" />
    {l "Instance Roles / Circles"}
  </LivePatch>
</li> -->

<!-- <li
  :if={Settings.get(:experimental_features_enabled, false, @__context__)}
  >
  <LivePatch 
    to={~p"/boundaries/instance_acls"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "instance_acls"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="LockClosed" class={"w-4 h-4 font-normal ", "": @selected_tab == "feed"} />
    {l "Local Boundaries"}
  </LivePatch>
</li> -->

<!-- <li>
  <LivePatch 
    to={~p"/boundaries/acl/#{Bonfire.Boundaries.Fixtures.instance_acl}"}
    class={""rounded-md,  "'bg-base-content/10 '": @id == Bonfire.Boundaries.Fixtures.instance_acl}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon iconify="bxs:EditLocation" class={"w-4 h-4 font-normal ", "": @selected_tab == "feed"} />
    {l "Instance Boundaries"}
  </LivePatch>
</li> -->

<!-- <li class="mt-1 uppercase menu-title">
  <span>{l "Moderation"}</span>
</li> -->
<!-- 
<li
  :if={Bonfire.Boundaries.can?(@__context__, :mediate, :instance)}
  >
  <LivePatch 
    to={~p"/settings/flags"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "flags"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="Flag" class={"inline-block w-4 h-4 mr-2 stroke-current", "": @selected_tab == "extensions"} />
    {l "Flags"}
  </LivePatch>
</li> -->

<!-- <li :if={Bonfire.Boundaries.can?(@__context__, :block, :instance)}>
  <LivePatch 
    to={~p"/boundaries/instance_ghosted"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "instance_ghosted"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="MinusCircle" class={"inline-block w-4 h-4 mr-2 stroke-current", "": @selected_tab == "extensions"} />
    {l "Ghosted instance-wide"}
  </LivePatch>
</li>
<li :if={Bonfire.Boundaries.can?(@__context__, :block, :instance)}>
  <LivePatch 
    to={~p"/boundaries/instance_silenced"}
    class={""rounded-md,  "'bg-base-content/10 '": @selected_tab == "instance_silenced"}>
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon solid="VolumeOff" class={"inline-block w-4 h-4 mr-2 stroke-current", "": @selected_tab == "extensions"} />
    {l "Silenced instance-wide"}
  </LivePatch>
</li> -->
<!-- 
<li>
  <LiveRedirect to="/logout" class="normal-case rounded btn-wide btn btn-error">
    <span class={"rounded bg-gradient-to-b from-cyan-500 to-blue-500 w-[28px] flex place-content-center h-[28px] items-center shadow-lg"}>
    <Icon
      solid="Logout"
      class={"w-4 h-4 text-error-content", "": @selected_tab == "feed"}
    />
    <span class="text-error-content">
      {l("Logout")}
    </span>
  </LiveRedirect>
</li> -->
