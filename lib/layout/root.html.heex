<!DOCTYPE html>
<html
  id="root"
  data-open="false"
  class="bg-base-100"
  lang="en"
  data-theme={
    if Settings.get(
         [:ui, :theme, :preferred],
         :system,
         assigns[:__context__] || assigns[:current_user] || @conn
       ) == :bonfire,
       do:
         Settings.get(
           [:ui, :theme, :instance_theme_light],
           "light",
           assigns[:__context__] || assigns[:current_user] || @conn
         ),
       else:
         Settings.get(
           [:ui, :theme, :instance_theme],
           "bonfire",
           assigns[:__context__] || assigns[:current_user] || @conn
         )
  }
  x-data={
    if Settings.get(
         [:ui, :theme, :preferred],
         :system,
         assigns[:__context__] || assigns[:current_user] || @conn
       ) == :system,
       do: "{
        prefersDarkTheme: window.matchMedia('(prefers-color-scheme: dark)').matches,
        dark_theme: $el.dataset.theme,
        light_theme: '#{Settings.get([:ui, :theme, :instance_theme_light],
       "light",
       assigns[:__context__] || assigns[:current_user] || @conn)}'
        }"
  }
  x-init={
    if Settings.get(
         [:ui, :theme, :preferred],
         :system,
         assigns[:__context__] || assigns[:current_user] || @conn
       ) == :system,
       do:
         "window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => { prefersDarkTheme = e.matches; });"
  }
  x-bind:data-theme={
    if Settings.get(
         [:ui, :theme, :preferred],
         :system,
         assigns[:__context__] || assigns[:current_user] || @conn
       ) == :system,
       do: "prefersDarkTheme ? dark_theme : light_theme"
  }
>
  <head>
    <meta charset="utf-8" />

    <SEO.juice
      page_title={assigns[:page_title]}
      canonical_url={assigns[:canonical_url]}
      conn={@conn}
      config={Bonfire.UI.Common.SEO.config()}
    />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <%= raw(Bonfire.Common.Config.endpoint_module().include_assets(@conn, :top)) %>

    <%= if assigns[:no_index] do %>
      <meta name="robots" content="noindex" />
    <% end %>

    <%= csrf_meta_tag() %>
  </head>

  <body id="layout-root">
    <%= @inner_content %>

    <%= raw(Bonfire.Common.Config.endpoint_module().include_assets(@conn, :bottom)) %>
  </body>
</html>
